---
title: "Assignment 1: The cocktail bar (data transformation and manipulation)"
author: "Zsuzsanna Pesthy"
output: html_document
editor_options: 
  chunk_output_type: console
---

# Skills needed to solve this assignment

-   Using R and RStudio, reading data
-   Reporting using RMarkdown
-   Using Git and Github (for submitting the task)
-   Data manipulation (e.g. dplyr, tidyr)
-   String manipulation (e.g. stringr)

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

# Background

Your Cuban uncle sets up a cocktail bar in downtown Budapest. He has a secret list of cocktails that he would like to serve in the bar. He asks you to do create a few lists and tables to set up the shop. As your uncle is a secret hipster, he has a dataset on Github that you can use for the task!

![](https://media1.tenor.com/images/57a519cffd0ad4693be3b9c94b211540/tenor.gif?itemid=5195211){width="320"}

Note: There are several different ways to solve these tasks, feel free to come up with your own.

## 1. Read the data

Read the cocktail dataset from: <https://github.com/nthun/cocktail-balance> You can also find the codebook there.

```{r}

#loading data
library(readr)


file_path <- "C:\\Users\\Zsuzsi\\BML-MEMO LAB Dropbox\\Lab_workspace\\PhD_msc_students\\Pesthy_Zsuzsi\\phd\\nt stat\\cocktail_data.tsv"

cocktail_data <- read_tsv(file_path, locale = locale(encoding = "UTF-8"))

```

## 2. Transform the data table and clean the ingredient variable!

The ingredients are currently in a single cell for each cocktail. It would be better to put them in separate rows. Also, the variable should be cleaned of all quantities (e.g. 1/2 oz, 2 dashes, etc.), and the indicator of alcohol content (e.g. 47.3% abv). You will need to use this cleaned table in later tasks.

```{r}
#Step 1: the ingredients are separated by <br/>, <b4/>, or <br>, so we replace those with actual line breaks. When two ingredients were listed as alternatives (with "or"), I also separated those so each option appears on its own line.
cocktail1 <- cocktail_data %>%
  mutate(
    ingredients = str_replace_all(ingredients, "<br/>|<br>|\\<b4/>| or ", "\n"))

#Step 2: split the ingredients so each one gets its own row
cocktail2 <- cocktail1 %>%
  separate_rows(ingredients, sep = "\n") %>% 
  mutate(ingredients = str_squish(ingredients))

#Step 3: remove measurement units and other extra characters
cocktail3 <- cocktail2 %>%
  mutate(
    ingredients = str_remove_all(ingredients, "oz|drops|dashes|dash|% abv\\)|\\(|/|\\d|\\."),
    ingredients = str_trim(ingredients))
```

## 3. All ingredients in alphabetical order

Before opening the bar, you need to find a reliable supplier that has all the ingredients. You need to send a list of all possible ingredients you will need. They don't need the quantities (i.e. how many of these are needed), just the names of the ingredients.

```{r}

#get each ingredient only once, in alphabetical order + remove duplicates
ingredients_list <- cocktail3 %>%
  distinct(ingredients) %>%
  arrange(ingredients) 

```

## 4. Number of unique ingredients

How many different ingredients you will need?

```{r}
#since each ingredient now appears only once in the dataset, we just need to count the number of rows
N_ingredients <- nrow(ingredients_list)

cat("In total,", N_ingredients, "ingredients will be needed.")
```

## 5. What are the top 10 ingredients?

What are the 10 most frequently used ingredients? If there are ties, you can list more than 10.

```{r}
#count how many times each ingredient appears and rank them
top_ingredients <- cocktail3 %>%
  count(ingredients, sort = TRUE) %>%
  mutate(
    rank = dense_rank(desc(n))
  )


#take the top 10 ingredients, treating ties as the same rank
top10_ingredients <- top_ingredients %>%
  filter(rank <= 10)

#print everything
print(top10_ingredients, n = Inf)

```

## 6. Which cocktail(s) has/have the most ingredients?

Count the number of ingredients and filter all the cocktails that has that many.

```{r}

#check which cocktails appear in the most rows in the final dataset, since rows are separated by ingredients
cocktail3_counts <- cocktail3 %>%
  count(name, sort = TRUE) 

#find the maximum number of rows
max_ingredients <- max(cocktail3_counts$n)
print(max_ingredients)

#find which cocktails have the highest count
#note: one cocktail contains an ingredient written as "clarified lime juice or champagne acid", which was split into two lines.
#Even though it appears as two ingredients in the data, technically the recipe only requires one of them, so it should have one fewer ingredient.
most_ingredients <- cocktail3_counts %>%
  filter(n >= max_ingredients-1)

cocktails_with_most <- most_ingredients$name

#filter the original dataset so only the cocktails with the most ingredients remain
cocktail3_top <- cocktail3 %>%
  filter(name %in% cocktails_with_most)

```

## 7. How many ingredients appear in only one cocktail (rare ingredient)?

Count all cocktails with only one ingredient, and

```{r}

#look at the dataset where we already counted ingredient frequencies
rare_ingredients <- top_ingredients %>%
  filter(n == 1)

cat("In total,", nrow(rare_ingredients), "ingredients appear only once in the dataset")

#the task description wasn't finished, but based on the previous steps, I'm guessing the goal would be to filter the cocktails that contain at least one unique ingredient. So that's what I'll do here.
cocktails_with_rare <- cocktail3 %>%
  filter(ingredients %in% rare_ingredients$ingredients)


```

## 8. Which cocktail has an ingredient that is only used in one cocktail?

```{r}

cat("These cocktails contain the rare ingredients:", paste(unique(cocktails_with_rare$name), collapse = ", "), "\n")

```

## 9. What are the cocktails without rare ingredients?

```{r}
#now the opposite: exclude cocktails that contain rare ingredients
cocktails_without_rare <- cocktail3 %>%
  filter(!name %in% cocktails_with_rare$name)


#which cocktails contain no rare ingredients
cat("These cocktails do not contain any rare ingredients:", paste(unique(cocktails_without_rare$name), collapse = ", "))


#check if I did it correctly and if there is any overlap
intersect(unique(cocktails_with_rare$name), unique(cocktails_without_rare$name))


```

## 10. Create a cheat sheet for the bartender!

Create a matrix that shows all cocktail names as rows and all ingredients as columns. When a cocktail requires an ingredient, there should be an "X" in the cell, otherwise, the cell should remain empty. Example:

```{r echo=FALSE}
tribble(~name, ~Lime, ~`White rum`, ~`Cane sugar`, ~`Coca-cola`, ~Mint, ~Soda,
        "Caipirissima", "X", "X", "X", "", "", "",
        "Cuba Libre", "X", "X", "", "X","","",
        "Mojito", "X", "X", "", "", "X", "X") %>% 
    relocate(name, sort(names(.)))
```

```{r}
cheat_sheet <- cocktail3 %>%
  mutate(value = "X") %>%
  distinct(name, ingredients, value) %>%
  pivot_wider(
    names_from = ingredients,
    values_from = value,
    values_fill = list(value = ""))

#here is the cheatsheet:)
View(cheat_sheet)
```




Congrats, the bar is now officially open!

![](https://i.pinimg.com/originals/4e/c1/0c/4ec10c9d32b2c7c28b4b638c7f809ec5.gif){width="320"}
